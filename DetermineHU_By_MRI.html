<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Static Layout</title>
  <!-- Include Bootstrap CSS -->
  <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body,
    html {
      margin: 0;
      padding: 0;
      height: 100%;
      font-family: Arial, sans-serif;
    }

    .container {
      display: flex;
      flex-direction: column;
      height: 100%;
      padding: 10px;
      box-sizing: border-box;
    }

    .textareas {
      display: flex;
      flex: 1;
      margin-top: 10px;
    }

    textarea {
      width: 50%;
      height: calc(100% - 20px);
      margin: 0;
      padding: 10px;
      box-sizing: border-box;
      resize: none;
      overflow-y: auto;
      word-wrap: break-word;
    }

    #textarea1 {
      border-right: 1px solid #ccc;
    }

    .execute-button {
      position: absolute;
      top: 10px;
      right: 10px;
    }
  </style>
</head>

<body>
  <button class="execute-button btn btn-primary">Execute</button>
  <div class="container">
    <h4 class="text-center">XÁC ĐỊNH GIÁ TRỊ HU DỰA TRÊN MRI</h4>
      <div class="textareas">
        <textarea id="textarea1" placeholder="{TextArea1}">
---MRI---
334
422
98
23
667
---DATA---
MRI	HU
46,33333333	102,1428571
93,33333333	77
243,8888889	80,18181818
296,8888889	65,21212121
282,6666667	66,09375
279,4444444	79,85
272,2222222	62,4
308	39,3
369,3333333	45,37931034
294,6666667	63,35
243,1111111	65,96153846
259,1111111	47,65384615
251,3333333	39,91666667
240,1111111	44,79166667
243,5555556	53,85185185
255,6666667	52,82352941
253,3333333	47,59259259
234	54,94871795
239,1111111	47,87179487
253,8888889	43,95121951
263,2222222	27,78571429
291,3333333	20,97619048
249,8888889	36,80952381
258,5555556	49,13953488
264	46,82352941
81,22222222	83,38888889
239,1111111	78,625
287,8888889	72,11111111
284,8888889	63,61111111
276	66,38888889
275,7777778	67,79166667
276,8888889	41,80555556
374,3333333	31,52777778
350,8888889	50,74285714
255,5555556	57
262	58,02777778
261	51,52777778
249,4444444	49,56666667
247	51,06060606
251,6666667	51,36111111
256,25	55,34285714
249	45,5
238,1111111	51,27777778
242,8888889	51
256,3333333	48,52631579
279	28,41666667
286,5555556	17,05555556
240,8888889	34,66666667
264,8888889	46,18181818
268,5555556	53,88
222,5555556	59,23333333
289,3333333	57,25
283,8888889	66,03333333
280,2222222	69,125
275,2222222	65,63636364
274,1111111	53,625
323,4444444	34,45454545
407	33,02857143
294,2222222	43,6969697
248,5555556	46,36666667
263,3333333	52,11111111
260,8888889	55,63888889
261,8888889	54,17241379
261	56,02857143
260,2222222	56,77777778
262,1666667	51,36111111
245,1111111	37,125
244	40,97222222
254,8888889	52,13888889
252,5555556	43,45238095
292,5555556	16,7
259	31,24444444
245,1111111	39,44444444
268	33,68292683
268,2222222	45,78947368
283,3333333	68,93939394
286,4444444	57,09090909
282,3333333	59,45454545
278	70,21875
272,4444444	61,16666667
277,7777778	42,18181818
387,6666667	28,5
341	35,34482759
248,1111111	46,45833333
258,7777778	47,20833333
263	49,16666667
265	54,11538462
262,3333333	51,65
257,3333333	48,18518519
276,8888889	52,44827586
264,1666667	49,26666667
241,1111111	45,65
254,8888889	41,63333333
255,2222222	44,03125
267,1111111	40,39393939
283,6666667	24,58333333
243,2222222	49,21052632
253,3333333	44,86046512
273,8888889	39,94871795
264,4444444	40,94871795
282,7777778	56,22222222
274,4444444	54,04166667
274,4444444	55,19444444
267,1111111	59,30555556
271,5555556	54,47058824
332,6666667	42,3
374,1111111	35,69444444
230	45,55555556
248,6666667	51,96666667
271,3333333	45,3030303
263,6666667	53,13888889
259,7777778	53,58333333
255,5555556	52,29166667
262	46,22222222
264,8888889	54,14285714
237,5833333	48,75757576
246,1111111	48,27272727
252,5555556	39,78787879
248,7777778	46,625
279,7777778	41,96666667
263	25,54545455
260,8888889	50,66666667
275,2222222	49,5862069
291,2222222	42,96428571
271,5555556	41,39285714
273,4444444	52,06666667
273,1111111	61,40909091
274	60,35483871
269,1111111	43,45454545
299,7777778	43,16666667
370,4444444	39,34482759
267,4444444	46,38235294
236	51,11111111
261,6666667	50,53571429
270,2222222	43,27777778
265,6666667	45,16666667
260,4444444	44,63888889
262,8888889	49,29166667
263	47,88888889
225,1111111	50,36111111
239,5833333	48,30555556
254,1111111	51
250,6666667	38,41666667
255,1111111	39,22222222
285,2222222	26,77142857
249	31,5862069
269,3333333	58,5
281,8888889	42,83333333
292,7777778	39,9
277,7777778	40,48484848
276,3333333	53,42424242
273	53,4
272,6666667	52,60606061
282,5555556	43,63333333
354,7777778	50,61538462
297,3333333	48,03846154
241,8888889	53,03333333
262	46,14814815
259	48,05
256,3333333	55,4
267,1111111	45,95833333
264,4444444	32,88888889
272,8888889	36,94444444
244,3333333	54,46428571
221,1111111	53,83333333
251,5833333	51,5
260,3333333	51,52173913
258,6666667	45,09677419
277,6666667	34
279	23,56666667
250,4444444	44,85714286
274,2222222	55,61764706
283	47,61111111
292,3333333	41,75862069
285,3333333	36,2
277,6666667	48,27272727
276,2222222	44,06666667
278,4444444	40,66666667
339,7777778	38,55555556
324,8888889	52,56666667
252,3333333	51,70588235
270,1111111	56,52777778
264,5555556	42,16666667
255	41,16666667
250,7777778	52,72222222
260,2222222	57,11111111
265	47,11111111
295,6666667	43
230	58,11111111
225,8888889	58,60606061
254,25	52,54545455
268,4444444	47,36
272,7777778	39,33333333
298,4444444	36,46666667
262,2222222	36,23076923
263,8888889	55,19230769
272,1111111	59,83333333
284	49,51851852
292,3333333	40,26315789
296,4444444	42,16666667
278,7777778	45,38461538
276	33,96428571
347,3333333	12,93939394
378,3333333	29,06060606
262,8888889	43,70833333
254,6666667	52,47058824
279	49,83333333
269,1111111	45,05555556
254,8888889	38,33333333
251,4444444	51,55555556
254,8888889	47,58333333
278,6666667	46,38888889
355,5555556	38,33333333
289,7777778	44,22222222
245,5555556	57,88888889
260,5	50,39393939
270,5555556	46,5
296,1111111	43,27777778
304,1111111	32,38888889
255,2222222	38,03333333
266,1111111	44,75757576
263,6666667	47,91666667
280,8888889	52,69444444
287,1111111	43,75
310,4444444	34,94444444
278,4444444	43,89285714
318,6666667	29,8
378,7777778	23,86666667
311,3333333	46
270,8888889	44,5
251,6666667	58
269,2222222	63,25925926
261,1111111	46,40740741
254	41,38888889
259,6666667	44,16666667
263,4444444	45,5
274	33,44444444
256,7777778	17,0952381
263,8888889	32,6
259,6666667	58,26666667
262,25	44,76923077
268,1111111	43,85185185
308,2222222	40,96969697
289,3333333	29,27272727
264,1111111	41,24
263,3333333	48,45454545
267,7777778	47,94444444
279,7777778	50,55555556
286,8888889	45,45833333
310,2222222	42,38888889
293,2222222	38,27586207
385,4444444	18,48571429
294	40,63888889
271,7777778	54,25
290,4444444	51,20833333
270,1111111	58,33333333
265,5555556	60,13888889
258,1111111	57,08333333
259	52,91666667
266,1111111	57,11111111
282,7777778	59,5
214,7777778	42,30555556
199,7777778	30,66666667
257,3333333	39,61764706
260,4444444	49,18181818
273,8333333	36,85714286
276,7777778	41,5
302,2222222	33,96774194
270,5555556	29
270,1111111	44,95454545
267,4444444	48,73333333
272,6666667	51,89285714
284	46,96296296
287	31,23529412
299,8888889	46,48
398,4444444	23,90909091
380,7777778	12,78125
243,1111111	26,24242424
274,5555556	47,96969697
284,3333333	59,72727273
272	60,14285714
270,5555556	58,22222222
269,8888889	54,41666667
267,5555556	51,33333333
273,6666667	63,38888889
277,4444444	62,11111111
230,4444444	48,54545455
220,3333333	53,46666667
265,5555556	54,5
270,5555556	52,86111111
277,1666667	49,06896552
290,3333333	48,57142857
294,1111111	24,13888889
270,3333333	40,55555556
265,6666667	61,16666667
271,4444444	47,05555556
273,1111111	51,94444444
283	53,11111111
287,1111111	32,45833333
286,8888889	40,75
457,3333333	32,33333333
350,2222222	31,90625
238,8888889	29,4
267	39,26666667
267,5555556	48,65
269,5555556	61,03448276
281,3333333	61
285	49,11111111
274,3333333	50,2
271,8888889	54,58333333
275,1111111	53,55555556
263,3333333	43,125
230,3333333	42,57692308
271,7777778	51,6
272,6666667	52,6
272,0833333	48,63636364
293,1111111	41
286,8888889	21,60606061
272,4444444	36,54545455
264,8888889	53,63636364
273	51,68571429
265,8888889	45,75
272,8888889	40,36111111
286,8888889	34,25
282,4444444	42,86111111
398,5555556	31,13793103
326,3333333	43,02439024
248,5555556	34,61111111
273,7777778	47,16666667
265,3333333	56
272,5555556	57,75
281,3333333	51,86111111
284	42,6
283,5555556	45,93103448
273,5555556	50,47222222
263,6666667	48,69444444
267,5555556	50,7
240,1111111	46,3125
267	50,84848485
266,2222222	57,60606061
271,4166667	56,95833333
288,6666667	41,625
276,2222222	24,16666667
266,6666667	32,33333333
266,2222222	42,55
264,4444444	48,5862069
261,1111111	52,25925926
272,2222222	42,11538462
282	34,83333333
272,7777778	45,96153846
381,4444444	36,69230769
317	49,35897436
260,1111111	36,02631579
277,6666667	46,97058824
278,4444444	55,45833333
283,5555556	51
285,1111111	47,58333333
265	44,6969697
264,4444444	42,43333333
271,5555556	57,11111111
253,2222222	53,22222222
248,8888889	49,4137931
255,1111111	44,71428571
258,2222222	46,5
266,4444444	63,83333333
290,9166667	72,66666667
296,8888889	40,11111111
269,5555556	31,38888889
264,3333333	46,58333333
266,5555556	52,83333333
267,2222222	48,75
264	45,94444444
277,1111111	49,97142857
276,6666667	40,72413793
270,6666667	45,22222222
363,8888889	30,37037037
321,6666667	43,07692308
262,8888889	33,58974359
276,8888889	39,63157895
278,4444444	49,96153846
283,8888889	56,5
301,1111111	45,03703704
308,4444444	56,52173913
293,8888889	46,13043478
252,5555556	50,2
244,3333333	58,96296296
255,6666667	56,9047619
259,3333333	47,03333333
264,6666667	40,16666667
264,6666667	46,7
305,8333333	55,36363636
295,2222222	33,51515152
270,5555556	35,09090909
265,1111111	44,15151515
268,7777778	56,29166667
266,3333333	54,86111111
264,8888889	50,11111111
281,8888889	45,54545455
281,8888889	34,96666667
282,5555556	45,33333333
340,6666667	47,06666667
322,3333333	40,66666667
268,7777778	35,53333333
274,5555556	38,80952381
271,2222222	52,69444444
274,5555556	59,77777778
288,1111111	41,20930233
402,2222222	44,93939394
355,8888889	46,6969697
243,8888889	47,41666667
265,7777778	60,25
259,5555556	58,5
259,5555556	46,90909091
263,7777778	42,36363636
280,7777778	52,6969697
320,5	63,19047619
288,4444444	33,56666667
265	25,76666667
271,6666667	38,56666667
268,6666667	45
267,3333333	49,85185185
268,7777778	48,11111111
294,2222222	53
290,6666667	47,31818182
294,8888889	47,14814815
311,3333333	39,92307692
319,2222222	43,20512821
277	46,97435897
279,6666667	54,75675676
279,8888889	52,86111111
269,2222222	49,76190476
263	53,57142857
336,6666667	53,25
284,6666667	50,75609756
255,7777778	46,9
272,6666667	54,19444444
266,6666667	54,29166667
266,7777778	46,52777778
274,6666667	41,27777778
311,4444444	48,27777778
330,9166667	53,95833333
294,4444444	34,13888889
263	32,75
273,6666667	47,8
273	47,62068966
268,2222222	45,38888889
278,3333333	39,75
322,4444444	49,63333333
308,8888889	49,15151515
295,6666667	44,05555556
298,7777778	41,93103448
318,3333333	45,02564103
278,1111111	48,1025641
281,6666667	54,23529412
281	46,6
270,4444444	47,30555556
267,7777778	55,75
308,6666667	55,5
255,8888889	51,21428571
264,1111111	44,8125
273,1111111	56,88235294
270	52,85714286
269,6666667	47,33333333
281,7777778	44,23333333
319,8888889	37,625
347,25	30,81818182
294,1111111	30,42424242
273,3333333	30,51515152
273,1111111	42,125
276,8888889	45,7
272,2222222	50,02777778
291,3333333	50,33333333
353,5555556	55,31034483
321,4444444	35,62857143
299	30,30555556
311,7777778	51,72222222
326,7777778	46,97777778
280,6666667	40,26666667
283,1111111	40,87179487
275,8888889	39,425
268,3333333	53,95555556
259,3333333	50,17777778
277,5555556	44,6969697
256,6666667	47,4
263	50,71111111
271,5555556	59,93181818
291	49,35714286
277,1111111	30,82051282
293,2222222	48,58333333
314,6666667	47,375
347,75	41,13043478
296,7777778	32,1
278,4444444	30,66666667
272,7777778	38,4
279,3333333	36,20833333
272	44,03703704
322,5555556	53,77777778
370,8888889	61,73684211
309,8888889	31,36
302,1111111	31,22222222
340,8888889	52,79411765
334,2222222	50,15384615
270,7777778	47,2195122
272	47,96875
271,8888889	41,6
267,8888889	49,33333333
252,4444444	45,29545455
260	39,8
258,5555556	41,42222222
265,6666667	49,97777778
275,8888889	60,35555556
285,6666667	53,7
276,4444444	35,91111111
300,5555556	44,35555556
306,4444444	44,15
348,1666667	42,72727273
314,6666667	31,61111111
283,5555556	38,44444444
275,8888889	42
280,5555556	38,27272727
282,3333333	40,25
349,4444444	40,27777778
344,1111111	51,52
308,8888889	40,97222222
296,1111111	37,22222222
358	49,0625
341,3333333	43,71794872
263,3333333	44,21052632
272,3333333	46,16666667
277,3333333	40
272,1666667	41,88888889
255,1666667	46,62857143
256,6666667	45,23809524
264,3333333	53,8
269,6666667	52
279,8333333	51,77777778
281,6666667	41
291,8333333	35,47222222
307,1666667	29,40540541
304,3333333	31,88571429
346	40,67647059
317,5	35,28947368
288,1666667	45,91428571
285	51,40740741
281,8333333	51
300,6666667	50,27777778
327,8333333	39,02777778
318,6666667	42,375
317,1666667	42,91666667
293,5	38,83333333
416,4444444	37,51219512
344,2222222	40,02222222
260,2222222	44,66666667
276,3333333	39,6875
275,4444444	39,35555556
272,7777778	49,66666667
267,6666667	53,4
271,4444444	43,96666667
275	51,37777778
270,3333333	60,95555556
281,4444444	55,95121951
286,4444444	51,375
308,7777778	45,83333333
311,8888889	30,88095238
309	25,31428571
333,1666667	36,8125
313,2222222	40,58974359
293,4444444	49,63157895
292	41,42307692
281,4444444	42,14285714
293,5555556	50,62962963
310,6666667	51
322,3333333	55,9375
321,7777778	48,69230769
299,4444444	34,89285714
380,6666667	38,83783784
311,6666667	45,075
267,3333333	56,23809524
276,7777778	49,89285714
276,3333333	39,11904762
269,4444444	45,60465116
281,2222222	46,68888889
287,4444444	47,96666667
280,3333333	53,68888889
272	58,97777778
280,8888889	51,88095238
285	54,13888889
334,4444444	55,93333333
325	38,86666667
323	27,97368421
321,3333333	36,85365854
314,3333333	44,22222222
303,5555556	42,26666667
289,8888889	41,5
282,1111111	38,62222222
288,1111111	43,42857143
312,1111111	46,65789474
325,3333333	56,29166667
319,5555556	50,11111111
304,7777778	35,05555556
283,2222222	39,60526316
298,3333333	47,25641026
280,3333333	54,75
274,2222222	51,29166667
275,4444444	35,80555556
272,8888889	45,22222222
279,6666667	45,84375
304,1111111	45,52380952
300,7777778	55,46875
280,3333333	48,5
283,3333333	45,96875
299,8888889	47,64516129
365,5555556	50,27777778
331	36,92307692
332,1111111	32,33333333
327,6666667	37
304,4444444	45,15384615
291,4444444	40,38095238
279,3333333	43,39285714
281,8888889	40,21428571
290,1111111	41,66666667
311,8888889	46,75555556
322	54,79310345
307,6666667	42,55
294,2222222	40,11111111
        </textarea>
        <textarea id="textarea2" placeholder="{TextArea2}"></textarea>
      </div>
  </div>

  <!-- Include jQuery -->
  <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
  <!-- Include Lodash -->
  <script src="https://cdn.jsdelivr.net/npm/lodash@4.17.20/lodash.min.js"></script>
  <!-- Include Bootstrap JS -->
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>

  <script>
    // Đăng ký sự kiện click sau khi trang load hoàn tất
    $(document).ready(function () {
  $(".execute-button").click(function () {
    let { MRIS, data } = processInput($('#textarea1').val());

    console.log("MRIS:", MRIS);
    console.log("Data:", data);

    let results = MRIS.map(mri => {
      let min, max;

      for (let i = 0; i < data.length - 1; i++) {
        if (data[i].mri <= mri && mri <= data[i + 1].mri) {
          min = data[i];
          max = data[i + 1];
          break;
        }
      }

      let avgHu = min && max ? (min.hu + max.hu) / 2 : null;

      return { mri, min, max, avgHu };
    });

    console.log("Results:", results);

    // Hiển thị kết quả vào textarea2
    $('#textarea2').text(results.map(r => 
      `MRI: ${r.mri}\nAvgHu: ${r.avgHu ?? 'cant determine'}\nMin: ${JSON.stringify(r.min)}\nMax: ${JSON.stringify(r.max)}\n=====================`
    ).join('\n'));
  });
});

function processInput(input) {
  let sections = input.split('---DATA---');
  let mrisSection = sections[0].replace('---MRI---', '').trim();
  let dataSection = sections[1].trim();

  // Parse MRIS
  let MRIS = mrisSection.split('\n').map(value => parseFloat(value.trim()));

  // Parse DATA
  let data = [];
  dataSection.split('\n').forEach(line => {
    let [mri, hu] = line.split('\t').map(value => parseFloat(value.replace(',', '.')));
    data.push({ mri, hu });
  });

  // Sort data by MRI values
  data = _.sortBy(data, 'mri');

  return { MRIS, data };
}

  </script>
</body>

</html>